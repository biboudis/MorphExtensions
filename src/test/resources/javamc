#!/bin/bash

# checker library
MORPHEXT_HOME=$HOME/Projects/MorphExtensions/target
LIB_NAME=MorphExtensions-0.0.1-SNAPSHOT.jar
LIB_PATH=$MORPHEXT_HOME/$LIB_NAME

# classpath setup - Can be generated by the maven plugin
CHECKERS_CP_PREFIX=$MORPHEXT_HOME/dependency
CHECKERS=$CHECKERS_CP_PREFIX/framework-1.7.2.jar
JAVAC=$CHECKERS_CP_PREFIX/compiler-1.7.2.jar
JDK7=$CHECKERS_CP_PREFIX/jdk7-1.7.2.jar
CHECKER_CP=$CHECKERS:$JAVAC:$JDK7

# checker framework
ENABLED_CHECKERS=checkers.MorphChecker
ENABLED_PLUGINS=ExpansionPlugin

# options for javac command
INPUT_FILES=
OPTIONS=
WHATIF=false

function usage
{
    echo "usage: javamc [-h] | [--whatif]] files"
}

if [ ! -f $LIB_PATH ]; then
    echo "error: morph extensions library not found or not generated."
    exit
fi

while [ "$1" != "" ]; do
    case $1 in
        -h | --help )
            usage
            exit
            ;;
        --whatif )
            WHATIF=true
            shift
            ;;
        *.java )
            INPUT_FILES="$INPUT_FILES $1"
            shift
            ;;
        * )
            shift
            ;;
    esac
done

# old command
# COMMAND="javac -XprintRounds -XprintProcessorInfo -Xbootclasspath/p:$LIB_PATH:$CHECKER_CP -processorpath $LIB_PATH:$CHECKER_CP -processor $ENABLED_CHECKERS $INPUT_FILES"
COMMAND="javac -Xbootclasspath/p:$LIB_PATH:$CHECKER_CP -processorpath $LIB_PATH:$CHECKER_CP -Xplugin:$ENABLED_PLUGINS $INPUT_FILES"

if $WHATIF
then
    echo $COMMAND
else
    $COMMAND
fi
